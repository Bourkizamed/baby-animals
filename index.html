<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#121212">
    <title>Baby Animal World</title>
    <style>
        :root { 
            --bg-color: #121212; /* Dark background for high contrast */
            --text-color: #ffffff; 
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            /* Prevent all accidental scrolling and gestures */
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            position: fixed;
        }

        /* Hidden but present for accessibility/SEO */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }

        .grid-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            box-sizing: border-box;
            transition: opacity 0.3s ease;
        }

        .grid {
            display: grid;
            gap: 15px;
            width: 100%;
            height: 100%;
            max-width: 600px;
            max-height: 90vh;
        }

        /* Portrait orientation: 2 columns, 3 rows */
        @media (orientation: portrait) {
            .grid {
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: repeat(3, 1fr);
            }
        }

        /* Landscape orientation: 3 columns, 2 rows */
        @media (orientation: landscape) {
            .grid {
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: repeat(2, 1fr);
            }
            
            /* Adjust font sizes for landscape */
            .emoji { 
                font-size: clamp(4rem, 10vw, 5rem) !important;
            }
            
            .name { 
                font-size: clamp(1rem, 4vw, 1.8rem) !important;
            }
        }

        .animal-card {
            border-radius: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            -webkit-tap-highlight-color: transparent;
            cursor: pointer;
            transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 4px solid rgba(255, 255, 255, 0.1);
            position: relative;
            z-index: 1;
        }

        /* High-saturation colors for baby visual stimulation */
        .animal-card:nth-child(1) { background-color: #ff595e; } /* Red */
        .animal-card:nth-child(2) { background-color: #ffca3a; } /* Yellow */
        .animal-card:nth-child(3) { background-color: #8ac926; } /* Green */
        .animal-card:nth-child(4) { background-color: #1982c4; } /* Blue */
        .animal-card:nth-child(5) { background-color: #6a4c93; } /* Purple */
        .animal-card:nth-child(6) { background-color: #ff924c; } /* Orange */

        .animal-card:active { 
            transform: scale(0.92); 
            filter: brightness(1.2);
        }

        .emoji { 
            font-size: clamp(4rem, 15vw, 6rem);
            display: block; 
            margin-bottom: 5px;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.2));
            transition: transform 0.3s ease;
        }

        .name { 
            font-size: clamp(1.2rem, 5vw, 2.2rem);
            font-weight: 900; 
            color: white;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: transform 0.3s ease;
        }

        /* Zoom overlay styles */
        .zoom-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            background-color: var(--bg-color);
        }

        .zoomed-card {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            border-radius: 0;
            animation: zoomIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .zoomed-emoji {
            font-size: clamp(8rem, 30vw, 12rem);
            display: block;
            margin-bottom: 20px;
            filter: drop-shadow(0 8px 8px rgba(0,0,0,0.3));
            animation: pulse 0.5s ease-in-out;
        }

        .zoomed-name {
            font-size: clamp(2.5rem, 10vw, 5rem);
            font-weight: 900;
            color: white;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        @keyframes zoomIn {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes zoomOut {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(0.5);
                opacity: 0;
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }

        /* Hide grid when zoomed */
        .zooming .grid-container {
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>

<h1 class="sr-only">Baby Animal World</h1>

<div class="grid-container">
    <div class="grid" id="animalGrid"></div>
</div>

<!-- Zoom overlay -->
<div class="zoom-overlay" id="zoomOverlay"></div>

<script>
    // ========== NUCLEAR BACK BUTTON PREVENTION ==========
    let backButtonBlocked = false;
    
    function nuclearBackButtonPrevention() {
        console.log('üöÄ Initializing nuclear back button prevention...');
        
        // 1. COMPLETELY replace history with current page
        history.replaceState('LOCKED', null, window.location.href);
        
        // 2. Override pushState to ALWAYS use current URL
        const originalPushState = history.pushState;
        history.pushState = function(state, title, url) {
            console.log('üîí pushState intercepted - forcing current URL');
            return originalPushState.call(history, state, title, window.location.href);
        };
        
        // 3. Override replaceState too
        const originalReplaceState = history.replaceState;
        history.replaceState = function(state, title, url) {
            console.log('üîí replaceState intercepted - forcing current URL');
            return originalReplaceState.call(history, state, title, window.location.href);
        };
        
        // 4. Catch ALL back button attempts with popstate
        window.addEventListener('popstate', function(event) {
            console.log('‚ö†Ô∏è popstate detected - back button attempt!');
            
            if (!backButtonBlocked) {
                backButtonBlocked = true;
                
                // IMMEDIATELY replace history
                history.replaceState('LOCKED', null, window.location.href);
                
                // Strong vibration feedback (distinct pattern)
                if ('vibrate' in navigator) {
                    navigator.vibrate([100, 50, 100, 50, 100]);
                }
                
                console.log('üö´ Back button BLOCKED (nuclear prevention active)');
                
                // Reset block after short delay
                setTimeout(() => { 
                    backButtonBlocked = false; 
                    console.log('üîÑ Back button protection ready again');
                }, 300);
            }
            
            // Prevent default behavior
            event.preventDefault();
            return false;
        }, true); // Use capture phase to catch it early
        
        // 5. For Android WebView/Cordova (if running in app wrapper)
        document.addEventListener('backbutton', function(e) {
            console.log('üì± Android back button detected!');
            e.preventDefault();
            e.stopPropagation();
            history.replaceState('LOCKED', null, window.location.href);
            
            if ('vibrate' in navigator) {
                navigator.vibrate([100, 50, 100, 50, 100]);
            }
            
            console.log('üö´ Android back button BLOCKED');
            return false;
        }, false);
        
        // 6. Continuous history locking (every 250ms for maximum protection)
        const historyLockInterval = setInterval(() => {
            if (history.state !== 'LOCKED') {
                history.replaceState('LOCKED', null, window.location.href);
                console.log('üîê History re-locked');
            }
        }, 250);
        
        // 7. Also prevent beforeunload (closing the app)
        window.addEventListener('beforeunload', function(e) {
            console.log('‚õî Attempt to close/refresh blocked');
            e.preventDefault();
            e.returnValue = 'Use the home button to exit the app. Back button is disabled for child safety.';
            return e.returnValue;
        });
        
        console.log('‚úÖ Nuclear back button prevention ACTIVATED');
        
        // Test vibration to confirm code is running
        if ('vibrate' in navigator) {
            setTimeout(() => {
                navigator.vibrate([100, 100]);
                console.log('üì≥ Test vibration - code is running');
            }, 500);
        }
    }

    // ========== Speech Manager ==========
    const SpeechManager = {
        currentUtterance: null,
        isSpeaking: false,
        
        speak(text, langCode) {
            // Cancel any ongoing speech immediately
            this.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = langCode;
            utterance.rate = 0.8;
            utterance.pitch = 1.2; // Higher pitch for baby-friendly tone
            utterance.volume = 1;
            
            // Adjust for Arabic - slower for proper pronunciation
            if (langCode === 'ar-SA') {
                utterance.rate = 0.7;
            }
            
            this.currentUtterance = utterance;
            
            utterance.onend = () => {
                this.currentUtterance = null;
                this.isSpeaking = false;
            };
            
            utterance.onerror = () => {
                this.currentUtterance = null;
                this.isSpeaking = false;
            };
            
            this.isSpeaking = true;
            window.speechSynthesis.speak(utterance);
        },
        
        cancel() {
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
                this.currentUtterance = null;
                this.isSpeaking = false;
            }
        }
    };

    const animals = [
        // Original 6 animals - using Arabic with ÿ™ÿ¥ŸÉŸäŸÑ for better pronunciation
        { en: "Lion", fr: "Lion", ar: "ÿ£Ÿéÿ≥ŸéÿØ", emoji: "ü¶Å" },
        { en: "Cat", fr: "Chat", ar: "ŸÇŸêÿ∑ŸëŸéÿ©", emoji: "üê±" },
        { en: "Dog", fr: "Chien", ar: "ŸÉŸéŸÑŸíÿ®", emoji: "üê∂" },
        { en: "Cow", fr: "Vache", ar: "ÿ®ŸéŸÇŸéÿ±Ÿéÿ©", emoji: "üêÆ" },
        { en: "Elephant", fr: "√âl√©phant", ar: "ŸÅŸêŸäŸÑ", emoji: "üêò" },
        { en: "Bird", fr: "Oiseau", ar: "ÿπŸèÿµŸíŸÅŸèŸàÿ±", emoji: "üê¶" }
    ];

    const languages = [
        { code: 'en-US', name: 'English' },
        { code: 'fr-FR', name: 'Fran√ßais' },
        { code: 'ar-SA', name: 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©' }
    ];

    // Store current language for each animal
    let animalLanguages = new Map();

    // Store current zoom state
    let isZoomed = false;
    let zoomTimeout = null;

    function getAnimalName(animal, langCode) {
        switch(langCode) {
            case 'fr-FR': return animal.fr;
            case 'ar-SA': return animal.ar;
            default: return animal.en;
        }
    }

    function showZoomedCard(animal, langCode) {
        if (isZoomed) return;
        
        isZoomed = true;
        
        // 1. Add zooming class to body
        document.body.classList.add('zooming');
        
        // 2. Get the zoom overlay
        const zoomOverlay = document.getElementById('zoomOverlay');
        
        // 3. Get the current animal name
        const name = getAnimalName(animal, langCode);
        
        // 4. Create the zoomed card
        zoomOverlay.innerHTML = `
            <div class="zoomed-card" style="background-color: ${getAnimalColor(animal)};">
                <span class="zoomed-emoji">${animal.emoji}</span>
                <span class="zoomed-name">${name}</span>
            </div>
        `;
        
        // 5. Show the zoom overlay
        zoomOverlay.style.display = 'flex';
        
        // 6. Speak the name
        SpeechManager.speak(name, langCode);
        
        // 7. Set timeout to hide the zoom after 3 seconds
        zoomTimeout = setTimeout(() => {
            hideZoomedCard();
        }, 3000);
    }

    function hideZoomedCard() {
        if (!isZoomed) return;
        
        const zoomOverlay = document.getElementById('zoomOverlay');
        
        // Add zoom out animation
        const zoomedCard = zoomOverlay.querySelector('.zoomed-card');
        if (zoomedCard) {
            zoomedCard.style.animation = 'zoomOut 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards';
        }
        
        // Hide after animation completes
        setTimeout(() => {
            zoomOverlay.style.display = 'none';
            zoomOverlay.innerHTML = '';
            document.body.classList.remove('zooming');
            isZoomed = false;
        }, 300);
        
        // Clear the timeout
        if (zoomTimeout) {
            clearTimeout(zoomTimeout);
            zoomTimeout = null;
        }
    }

    // Helper function to get animal color based on index
    function getAnimalColor(animal) {
        const index = animals.findIndex(a => a.en === animal.en);
        const colors = [
            '#ff595e', // Red
            '#ffca3a', // Yellow
            '#8ac926', // Green
            '#1982c4', // Blue
            '#6a4c93', // Purple
            '#ff924c'  // Orange
        ];
        return colors[index] || '#ff595e';
    }

    function render() {
        const grid = document.getElementById('animalGrid');
        grid.innerHTML = '';
        
        animals.forEach(animal => {
            const card = document.createElement('div');
            card.className = 'animal-card';
            
            // Default to English
            animalLanguages.set(animal.en, 'en-US');
            
            card.innerHTML = `
                <span class="emoji">${animal.emoji}</span>
                <span class="name">${animal.en}</span>
            `;
            
            // Baby-friendly interaction
            const handleInteraction = (e) => {
                e.preventDefault();
                
                // If already zoomed, hide it first
                if (isZoomed) {
                    hideZoomedCard();
                    return;
                }
                
                // 1. Haptic Feedback (Vibration)
                if ('vibrate' in navigator) navigator.vibrate([30, 50, 30]);

                // 2. Logic: Cycle through languages (more predictable than random)
                let currentLangCode = animalLanguages.get(animal.en);
                let currentIndex = languages.findIndex(l => l.code === currentLangCode);
                let nextIndex = (currentIndex + 1) % languages.length;
                let newLang = languages[nextIndex];

                animalLanguages.set(animal.en, newLang.code);
                
                // 3. Update Display
                card.querySelector('.name').textContent = getAnimalName(animal, newLang.code);
                
                // 4. Show zoomed card with the name
                showZoomedCard(animal, newLang.code);
            };

            card.addEventListener('touchstart', handleInteraction);
            card.addEventListener('mousedown', handleInteraction);
            
            grid.appendChild(card);
        });
    }

    // Initialize speech synthesis
    function initSpeech() {
        if ('speechSynthesis' in window) {
            // Get available voices (some browsers load them asynchronously)
            speechSynthesis.getVoices();
            
            // Re-check after a short delay
            setTimeout(() => {
                const voices = speechSynthesis.getVoices();
                console.log("Available TTS voices:", voices.length);
            }, 500);
        } else {
            console.error("Text-to-speech not supported in this browser");
        }
    }

    // Handle orientation change to ensure proper rendering
    function handleOrientationChange() {
        // Force a re-render to apply the correct grid layout
        render();
    }

    // Render the grid
    render();
    
    // ========== INITIALIZATION ==========
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üéØ Baby Animal World - DOM loaded');
        
        initSpeech();
        
        // Start NUCLEAR back button prevention IMMEDIATELY
        nuclearBackButtonPrevention();
        
        console.log('‚úÖ App fully initialized with back button protection');
    });
    
    // Also initialize when voices are loaded (some browsers)
    if ('speechSynthesis' in window) {
        speechSynthesis.onvoiceschanged = initSpeech;
    }

    // Listen for orientation changes
    window.addEventListener('orientationchange', handleOrientationChange);
    window.addEventListener('resize', handleOrientationChange);

    // Allow tap on zoom overlay to close it
    document.getElementById('zoomOverlay').addEventListener('click', hideZoomedCard);
    document.getElementById('zoomOverlay').addEventListener('touchstart', hideZoomedCard);

    // Prevent pulling down to refresh or zooming (but allow during zoom)
    document.addEventListener('touchmove', (e) => {
        if (!isZoomed) {
            e.preventDefault();
        }
    }, { passive: false });

    // Service Worker for PWA capabilities
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('sw.js').then(function(registration) {
                console.log('‚úÖ ServiceWorker registered successfully');
            }, function(err) {
                console.log('‚ùå ServiceWorker registration failed:', err);
            });
        });
    }

    // Extra protection: prevent any context menu (long press)
    document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
        return false;
    });

    // Prevent text selection
    document.addEventListener('selectstart', function(e) {
        e.preventDefault();
        return false;
    });

    // Prevent dragging images
    document.addEventListener('dragstart', function(e) {
        e.preventDefault();
        return false;
    });
</script>
</body>
</html>